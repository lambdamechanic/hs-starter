operations:
  - create_table:
      name: users
      columns:
        - name: id
          type: serial
          pk: true
        - name: provider
          type: text
        - name: subject
          type: text
        - name: email
          type: text
          nullable: true
        - name: display_name
          type: text
          nullable: true
        - name: avatar_url
          type: text
          nullable: true
        - name: created_at
          type: timestamptz
          default: now()
        - name: updated_at
          type: timestamptz
          default: now()
  - create_constraint:
      type: unique
      table: users
      name: users_provider_subject_key
      columns:
        - provider
        - subject
      up:
        provider: provider
        subject: subject
      down:
        provider: provider
        subject: subject
  - create_table:
      name: oauth_login_events
      columns:
        - name: id
          type: serial
          pk: true
        - name: user_id
          type: integer
        - name: provider
          type: text
        - name: raw_payload
          type: jsonb
        - name: logged_at
          type: timestamptz
          default: now()
  - create_constraint:
      type: foreign_key
      table: oauth_login_events
      name: oauth_login_events_user_id_fkey
      columns:
        - user_id
      references:
        table: users
        columns:
          - id
        on_delete: CASCADE
      up:
        user_id: user_id
      down:
        user_id: user_id
